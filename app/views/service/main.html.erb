<p><%= current_user.email %>의 페이지</p>
<a href="/users/sign_out" data-method = "delete">로그아웃</a>
<a href="/service/<%=current_user.id%>/setting">설정</a>
<div class="gridster">        <% y=1%>

    <ul>
    </ul>
</div>

<button class = "status"> 배치 저장 </button>

<script>
$(function(){ //DOM Ready
    var gridster;
    var position;

    gridster = $(".gridster ul").gridster({
        widget_margins: [10, 10],
        widget_base_dimensions: [280, 280]
    }).data('gridster');

    <% @service.each do |service|%>
        <% if service.id_service == 0 %>
            gridster.add_widget('<li class="new">  <%="#{render 'service/weather'}".gsub(/\n/,"").html_safe%> </li>',1,1,<%=service.position_x%>,<%=service.position_y%>);
        <% elsif service.id_service == 1 %>
            gridster.add_widget('<li class="new">  <%="#{render 'service/movie'}".gsub(/\n/,"").html_safe%> </li>',1, 2,<%=service.position_x%>,<%=service.position_y%>);
        <% elsif service.id_service == 2 %>
            gridster.add_widget('<li class="new">  <%="#{render 'service/music'}".gsub(/\n/,"").html_safe%> </li>',1, 1,<%=service.position_x%>,<%=service.position_y%>);
        <% elsif service.id_service == 3 %>
            gridster.add_widget('<li class="new">  <%="#{'주식'}".gsub(/\n/,"").html_safe%> </li>',<%=service.size_x%>, <%=service.size_y%>,<%=service.position_x%>,<%=service.position_y%>);
        <% elsif service.id_service == 4 %>
            gridster.add_widget('<li class="new">  <%="#{render 'service/luck'}".gsub(/\n/,"").html_safe%> </li>',2,1,<%=service.position_x%>,<%=service.position_y%>);
        <% elsif service.id_service == 5 %>
            gridster.add_widget('<li class="new">  <%="#{render 'service/wise'}".gsub(/\n/,"").html_safe%> </li>',1, 1,<%=service.position_x%>,<%=service.position_y%>);
        <% end %>

          <% if service.sequence>@user.service_number-1 %>
            <% if @posts.count/4 == 0 %>
              gridster.add_widget('<li class="new"><%="#{render '/posts/new'}".gsub(/\n/,"").html_safe%><%@posts.each do |p|%><div class="form-check"><input class="form-check-input" type="checkbox" ><label class="form-check-label"><b>할 일: </b><%=p.title%><b>내용: </b><%=p.content%></label></div><%end%> </li>',1, 1,<%=service.position_x%>,<%=service.position_y%>);
            <% elsif @posts.count/4 < 5 %>
              gridster.add_widget('<li class="new"><%="#{render '/posts/new'}".gsub(/\n/,"").html_safe%><%@posts.each do |p|%><div class="form-check"><input class="form-check-input" type="checkbox" ><label class="form-check-label"><b>할 일: </b><%=p.title%><b>내용: </b><%=p.content%></label></div><%end%> </li>',1, 2,<%=service.position_x%>,<%=service.position_y%>);
            <% else%>
              gridster.add_widget('<li class="new"><%="#{render '/posts/new'}".gsub(/\n/,"").html_safe%><%@posts.each do |p|%><div class="form-check"><input class="form-check-input" type="checkbox" ><label class="form-check-label"><b>할 일: </b><%=p.title%><b>내용: </b><%=p.content%></label></div><%end%> </li>',1, 3,<%=service.position_x%>,<%=service.position_y%>);
            <%end%>
            <% break %>
        <% end %>
    <% end %>

    $('.status').on('click',function(){
        position =gridster.serialize();
        $.ajax({
            url: "/service/<%=current_user.id%>/allocate",
            method: "POST",
            data: {
                position: position
            }
        });
    });
});
</script>
